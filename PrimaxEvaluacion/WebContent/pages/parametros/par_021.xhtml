<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml">

	<ui:define name="title">Planes de acción organizados por carpetas </ui:define>
	<ui:define name="content">

		<div class="card">
			<style type="text/css">
.ui-treetable {
	margin-top: 40px
}

.ui-treetable table {
	table-layout: fixed
}
</style>
			<h:form id="frm_par_021">
				<p:growl showDetail="true" id="mensajes">
				</p:growl>
				<div class="col-12">
					<div class="card">
						<h5>Filtros de Plan de Acción y Adjuntos</h5>
						<div class="ui-fluid formgrid grid">
							<div class="field col-12 md:col-1">
								<p:selectOneMenu id="cmbAnio"
									value="#{TreePlanAccionBn.anioSeleccionado}"
									converter="#{parametrosConverter}">
									<f:selectItem itemLabel="Año" />
									<f:selectItems value="#{TreePlanAccionBn.tipoAnioList}"
										var="anio" itemLabel="#{anio.nombreLista}" itemValue="#{anio}"></f:selectItems>
								</p:selectOneMenu>
							</div>
							<div class="field col-12 md:col-1">
								<p:selectCheckboxMenu id="cmbMeses"
									value="#{TreePlanAccionBn.mesesSeleccionados}" label="Meses"
									converter="#{parametrosConverter}" filter="false">
									<f:selectItems value="#{TreePlanAccionBn.tipoMesList}"
										var="mes" itemLabel="#{mes.nombreLista}" itemValue="#{mes}"></f:selectItems>
								</p:selectCheckboxMenu>
							</div>
							<div class="field col-12 md:col-1">
								<p:selectOneMenu id="cmbZona"
									value="#{TreePlanAccionBn.zonaSeleccionada}"
									disabled="#{TreePlanAccionBn.tipoGerente=='true'}"
									converter="#{zonaConverter}">
									<f:selectItem itemLabel="Zona" />
									<f:selectItems value="#{TreePlanAccionBn.tipoZonaList}"
										var="zona" itemLabel="#{zona.nombreZona}" itemValue="#{zona}"></f:selectItems>
									<p:ajax event="change" update="frm_par_021:cmbEstacion"></p:ajax>
								</p:selectOneMenu>
							</div>
							<div class="field col-12 md:col-1">
								<p:selectOneMenu id="cmbEstacion"
									value="#{TreePlanAccionBn.estacionSeleccionada}"
									disabled="#{TreePlanAccionBn.tipoGerente=='true'}"
									converter="#{agenciaConverter}" var="t" filter="true"
									filterMatchMode="contains">
									<f:selectItem itemLabel="Estación" />
									<f:selectItems value="#{TreePlanAccionBn.estacionList}"
										var="estacion" itemLabel="#{estacion.nombreAgencia}"
										itemValue="#{estacion}" />
									<p:column>
										<h:outputText value="#{t.nombreAgencia}" />
									</p:column>
								</p:selectOneMenu>
							</div>
							<div class="field col-12 md:col-1">
								<p:selectOneMenu id="cmbEvaluacion"
									value="#{TreePlanAccionBn.evaluacionSeleccionada}"
									converter="#{evaluacionConverter}">
									<f:selectItem itemLabel="Evaluación" />
									<f:selectItems value="#{TreePlanAccionBn.evaluacionList}"
										var="evaluacion" itemLabel="#{evaluacion.descripcion}"
										itemValue="#{evaluacion}"></f:selectItems>
								</p:selectOneMenu>
							</div>
							<div class="field col-12 md:col-1">
								<p:commandButton icon="pi pi-search"
									update="frm_par_021:pnl_rep" process="@this frm_par_021"
									action="#{TreePlanAccionBn.generar()}">
								</p:commandButton>
							</div>
						</div>
					</div>
				</div>
				<div align="center">
					<h2>Planes de acción organizados por carpetas</h2>
				</div>
				<div id="divF">
					<p:treeTable id="pnl_rep" widgetVar="treeTable"
						value="#{TreePlanAccionBn.root}" var="document"
						style="margin-top:0" selectionMode="single"
						selection="#{TreePlanAccionBn.selectedNode}">
						<p:column headerText="Nombre" filterBy="#{document.nombre}"
							filterMatchMode="contains">
							<h:outputText value="#{document.nombre}" />
						</p:column>
						<p:column headerText="Acción">
							<div align="center">
								<p:commandButton rendered="#{document.tipo eq 'Adjunto'}"
									title="Descargar Adjunto" icon="pi pi-cloud-upload" immediate="true"
									ajax="false"
									actionListener="#{appMain.fileDownloadPath(document.id0.toString(),document.nombre)}"
									process="@this">
									<p:fileDownload value="#{appMain.download}" />
								</p:commandButton>
								<p:commandButton icon="pi pi-cloud-download"
									update=":frm_par_021_3" rendered="#{document.tipo eq 'Plan'}"
									action="#{TreePlanAccionBn.checkListR(document.id0)}"
									title="Botón permite descargar y visualizar reportes"
									oncomplete="PF('dlg_par_021_3').show()">
								</p:commandButton>
								<p:commandButton rendered="#{document.tipo eq 'Plan'}"
									icon="pi pi-copy" immediate="true" ajax="false"
									title="Descargar Plan Acción"
									actionListener="#{ReporteBn.imprimirExcel(16,'360',document.id0.toString(),document.id1.toString(),null,null,null,null,null,null,null,false)}">
									<p:fileDownload value="#{appMain.download}" />
								</p:commandButton>
								<p:spacer></p:spacer>
								<p:commandButton rendered="#{document.tipo eq 'Plan'}"
									icon="pi pi-copy" immediate="true" ajax="false"
									title="Descargar Seguimiento Plan de  Acción"
									actionListener="#{ReporteBn.imprimirExcel(20,'1',document.id0.toString(),document.id1.toString(),null,null,null,null,null,null,null,false)}">
									<p:fileDownload value="#{appMain.download}" />
								</p:commandButton>
								<p:commandButton rendered="#{document.tipo eq 'Plan'}"
									value="#{TreePlanAccionBn.adjuntoKPI(document.id0)}"
									oncomplete="PF('dlg_par_021_1').show();"
									title="Evidencias del Plan de Acción" update=":frm_par_021_1"
									icon="pi pi-copy"></p:commandButton>
							</div>
						</p:column>

					</p:treeTable>
				</div>
			</h:form>
			<ui:include src="/pages/parametros/par_021_1.xhtml"></ui:include>
			<ui:include src="/pages/parametros/par_021_3.xhtml"></ui:include>
		</div>
	</ui:define>
</ui:composition>